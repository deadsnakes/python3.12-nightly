Refactor the compiler to reduce boilerplate and repetition.
